---
trigger:
  - platform: state
    not_to:
      - unknown
      - unavailable
    entity_id: sensor.weather_temperature
  - platform: template
    value_template: "{{ now().hour == 0 }}" # resets each day
action:
  - variables:
      source: "{{ states('sensor.weather_temperature') | float }}"
      now: "{{ now() }}"
sensor:
  - name: "[Weather] Temperature Today Maximum"
    unique_id: weather_today_max_temp
    unit_of_measurement: "°C"
    device_class: temperature
    state_class: measurement
    icon: mdi:thermometer-chevron-up
    state: |
      {% set current = (this.state or trigger.to_state.state) | float(source) %}
      {{ source if trigger.platform == 'template' else [source, current] | max }}
    attributes:
      category: weather
      datetime: |
        {% set current = (this.state or trigger.to_state.state) | float(source) %}
        {{ now if (trigger.platform == 'template' or source > current) else this.attributes.datetime|default(now) }}

  - name: "[Weather] Temperature Today Minimum"
    unique_id: weather_today_min_temp
    unit_of_measurement: "°C"
    device_class: temperature
    state_class: measurement
    icon: mdi:thermometer-chevron-down
    state: |
      {% set current = (this.state or trigger.to_state.state) | float(source) %}
      {{ source if trigger.platform == 'template' else [source, current] | min }}
    attributes:
      category: weather
      datetime: |
        {% set current = (this.state or trigger.to_state.state) | float(source) %}
        {{ now if (trigger.platform == 'template' or source < current) else this.attributes.datetime|default(now) }}
