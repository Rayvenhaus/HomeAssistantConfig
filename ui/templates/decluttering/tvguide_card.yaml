---
# TV Guide Card

tvguide_card:
  default:
    - entity: sensor.upcoming_sport_afl_all_teams
  card:
    type: custom:stack-in-card
    card_mod:
      style:
        .: |
          ha-card {
          padding-bottom: 10px !important;
          }
    cards:
      - type: custom:mushroom-template-card
        primary: >
          {{state_attr(entity, 'channel_name')}}
        secondary: >
          {% for r in state_attr(entity, 'programs_next24hrs') %}

          {% if as_datetime(r['start']) < now() < as_datetime(r['end']) %}
          {%- set ln = loop.index - 1 %}

          Now: {{ state_attr(entity, 'programs_next24hrs')[ln]['title'] }}

          Next: {{ state_attr(entity, 'programs_next24hrs')[ln+1]['title'] }}
          {% endif %}
          {% endfor %}
        #icon: mdi:television-guide
        entity: "[[entity]]"
        fill_container: true
        tap_action:
          action: none
        hold_action:
          action: none
        double_tap_action:
          action: none
        multiline_secondary: true
        card_mod:
          style:
            mushroom-state-info$: |
              .container {
                text-align: right;
              }
            .: |
              ha-card:before {
                content: '';
                position: absolute;
                height: 100%;
                width: 100%;
                left: 5px;
                background: url( {{ state_attr(config.entity, 'entity_picture') }} ) center no-repeat, linear-gradient(to left, transparent, var(--card-background-color) 1000%);
                background-repeat: no-repeat;
                background-size: auto 100%, cover;
                background-position: left;
                filter: opacity(0.75);
                }
              ha-card {
                # background-color: var(--background-color);
                box-shadow: none;
              }
      - type: custom:mushroom-chips-card
        alignment: center
        chips:
          - type: template
            tap_action:
              action: fire-dom-event
              browser_mod:
                service: browser_mod.popup
                hide_header: false
                data:
                  title: TV Guide - Today
                  content:
                    type: custom:layout-card
                    layout_type: custom:grid-layout
                    layout:
                      margin: 0
                      grid-template-columns: 1fr
                      grid-template-rows: 1fr
                      grid-template-areas: |
                        "col1"
                    cards:
                      - type: custom:hui-element
                        view_layout:
                          grid-area: col1
                        card_type: custom:flex-table-card
                        css:
                          table+: "padding: 0px; width: 100%; border-collapse: collapse;"
                          tbody tr:hover: "background-color: rgba(180, 70, 70,0.2) !important; color:white !important;"
                          tbody tr td:nth-child(1): "min-width: 1fr;width: 1fr; white-space: nowrap;"
                          th+: "border-bottom: 1px solid rgb(127,127,127);"
                        card_mod:
                          style:
                            .: |
                              ha-card {
                                overflow: auto;
                                box-shadow: none !important;
                                font-size: 12px;
                                }
                        entities:
                          include: "[[entity]]"
                        columns:
                          - name: Time
                            data: programs_today
                            modify: |-
                              var start = new Date(x.start);
                              var end = new Date(x.end);
                              String(start.getHours()).padStart(2,'0') + ":" +
                              String(start.getMinutes()).padStart(2,'0') + ' - ' +
                              String(end.getHours()).padStart(2,'0') + ":" +
                              String(end.getMinutes()).padStart(2,'0') + "<br/>" + x.length
                            align: center
                          - name: Program
                            data: programs_today
                            modify: |-
                              if (!x.subtitle) {
                                x.title + '<br/>' + x.details + '<details><summary>Details</summary><p>' + x.description + '</p></details>'
                              } else {
                                x.title + ', ' + x.subtitle + '<br/>' + x.details + '<details><summary>Details</summary><p>' + x.description + '</p></details>'
                              }
            hold_action:
              action: none
            double_tap_action:
              action: none
            icon: mdi:clock
            content: Today
            card_mod: &style
              style:
                .: |
                  ha-card {
                    background-color: rgb(80, 110, 172) !important;
                    box-shadow: none !important;
                  }
          - type: template
            tap_action:
              action: fire-dom-event
              browser_mod:
                service: browser_mod.popup
                hide_header: false
                data:
                  title: TV Guide - Today
                  content:
                    type: custom:layout-card
                    layout_type: custom:grid-layout
                    layout:
                      margin: 0
                      grid-template-columns: 1fr
                      grid-template-rows: 1fr
                      grid-template-areas: |
                        "col1"
                    cards:
                      - type: custom:hui-element
                        view_layout:
                          grid-area: col1
                        card_type: custom:flex-table-card
                        css:
                          table+: "padding: 0px; width: 100%; border-collapse: collapse;"
                          tbody tr:hover: "background-color: rgba(180, 70, 70,0.2) !important; color:white !important;"
                          tbody tr td:nth-child(1): "min-width: 1fr;width: 1fr; white-space: nowrap;"
                          th+: "border-bottom: 1px solid rgb(127,127,127);"
                        card_mod:
                          style:
                            .: |
                              ha-card {
                                overflow: auto;
                                box-shadow: none !important;
                                font-size: 12px;
                                }
                        entities:
                          include: "[[entity]]"
                        columns:
                          - name: Time
                            data: programs_tomorrow
                            modify: |-
                              var start = new Date(x.start);
                              var end = new Date(x.end);
                              String(start.getHours()).padStart(2,'0') + ":" +
                              String(start.getMinutes()).padStart(2,'0') + ' - ' +
                              String(end.getHours()).padStart(2,'0') + ":" +
                              String(end.getMinutes()).padStart(2,'0') + "<br/>" + x.length
                            align: center
                          - name: Program
                            data: programs_tomorrow
                            modify: |-
                              if (!x.subtitle) {
                                x.title + '<br/>' + x.details + '<details><summary>Details</summary><p>' + x.description + '</p></details>'
                              } else {
                                x.title + ', ' + x.subtitle + '<br/>' + x.details + '<details><summary>Details</summary><p>' + x.description + '</p></details>'
                              }
            hold_action:
              action: none
            double_tap_action:
              action: none
            icon: mdi:clock
            content: Tomorrow
            card_mod: *style
      - type: custom:mushroom-chips-card
        alignment: center
        chips:
          - type: template

            tap_action:
              action: fire-dom-event
              browser_mod:
                service: browser_mod.popup
                hide_header: false
                data:
                  title: TV Guide - Today
                  content:
                    type: custom:layout-card
                    layout_type: custom:grid-layout
                    layout:
                      margin: 0
                      grid-template-columns: 1fr
                      grid-template-rows: 1fr
                      grid-template-areas: |
                        "col1"
                    cards:
                      - type: custom:hui-element
                        view_layout:
                          grid-area: col1
                        card_type: custom:flex-table-card
                        css:
                          table+: "padding: 0px; width: 100%; border-collapse: collapse;"
                          tbody tr:hover: "background-color: rgba(180, 70, 70,0.2) !important; color:white !important;"
                          tbody tr td:nth-child(1): "min-width: 1fr;width: 1fr; white-space: nowrap;"
                          th+: "border-bottom: 1px solid rgb(127,127,127);"
                        card_mod:
                          style:
                            .: |
                              ha-card {
                                overflow: auto;
                                box-shadow: none !important;
                                font-size: 12px;
                                }
                        entities:
                          include: "[[entity]]"
                        columns:
                          - name: Time
                            data: programs_day3
                            modify: |-
                              var start = new Date(x.start);
                              var end = new Date(x.end);
                              String(start.getHours()).padStart(2,'0') + ":" +
                              String(start.getMinutes()).padStart(2,'0') + ' - ' +
                              String(end.getHours()).padStart(2,'0') + ":" +
                              String(end.getMinutes()).padStart(2,'0') + "<br/>" + x.length
                            align: center
                          - name: Program
                            data: programs_day3
                            modify: |-
                              if (!x.subtitle) {
                                x.title + '<br/>' + x.details + '<details><summary>Details</summary><p>' + x.description + '</p></details>'
                              } else {
                                x.title + ', ' + x.subtitle + '<br/>' + x.details + '<details><summary>Details</summary><p>' + x.description + '</p></details>'
                              }
            hold_action:
              action: none
            double_tap_action:
              action: none
            icon: mdi:clock
            content: Day 3
            card_mod: &style2
              style:
                .: |
                  ha-card {
                    background-color: #626569 !important;
                    box-shadow: none !important;
                  }
          - type: template
            tap_action:
              action: fire-dom-event
              browser_mod:
                service: browser_mod.popup
                hide_header: false
                data:
                  title: TV Guide - Today
                  content:
                    type: custom:layout-card
                    layout_type: custom:grid-layout
                    layout:
                      margin: 0
                      grid-template-columns: 1fr
                      grid-template-rows: 1fr
                      grid-template-areas: |
                        "col1"
                    cards:
                      - type: custom:hui-element
                        view_layout:
                          grid-area: col1
                        card_type: custom:flex-table-card
                        css:
                          table+: "padding: 0px; width: 100%; border-collapse: collapse;"
                          tbody tr:hover: "background-color: rgba(180, 70, 70,0.2) !important; color:white !important;"
                          tbody tr td:nth-child(1): "min-width: 1fr;width: 1fr; white-space: nowrap;"
                          th+: "border-bottom: 1px solid rgb(127,127,127);"
                        card_mod:
                          style:
                            .: |
                              ha-card {
                                overflow: auto;
                                box-shadow: none !important;
                                font-size: 12px;
                                }
                        entities:
                          include: "[[entity]]"
                        columns:
                          - name: Time
                            data: programs_day4
                            modify: |-
                              var start = new Date(x.start);
                              var end = new Date(x.end);
                              String(start.getHours()).padStart(2,'0') + ":" +
                              String(start.getMinutes()).padStart(2,'0') + ' - ' +
                              String(end.getHours()).padStart(2,'0') + ":" +
                              String(end.getMinutes()).padStart(2,'0') + "<br/>" + x.length
                            align: center
                          - name: Program
                            data: programs_day4
                            modify: |-
                              if (!x.subtitle) {
                                x.title + '<br/>' + x.details + '<details><summary>Details</summary><p>' + x.description + '</p></details>'
                              } else {
                                x.title + ', ' + x.subtitle + '<br/>' + x.details + '<details><summary>Details</summary><p>' + x.description + '</p></details>'
                              }
            hold_action:
              action: none
            double_tap_action:
              action: none
            icon: mdi:clock
            content: Day 4
            card_mod: *style2
          - type: template

            tap_action:
              action: fire-dom-event
              browser_mod:
                service: browser_mod.popup
                hide_header: false
                data:
                  title: TV Guide - Today
                  content:
                    type: custom:layout-card
                    layout_type: custom:grid-layout
                    layout:
                      margin: 0
                      grid-template-columns: 1fr
                      grid-template-rows: 1fr
                      grid-template-areas: |
                        "col1"
                    cards:
                      - type: custom:hui-element
                        view_layout:
                          grid-area: col1
                        card_type: custom:flex-table-card
                        css:
                          table+: "padding: 0px; width: 100%; border-collapse: collapse;"
                          tbody tr:hover: "background-color: rgba(180, 70, 70,0.2) !important; color:white !important;"
                          tbody tr td:nth-child(1): "min-width: 1fr;width: 1fr; white-space: nowrap;"
                          th+: "border-bottom: 1px solid rgb(127,127,127);"
                        card_mod:
                          style:
                            .: |
                              ha-card {
                                overflow: auto;
                                box-shadow: none !important;
                                font-size: 12px;
                                }
                        entities:
                          include: "[[entity]]"
                        columns:
                          - name: Time
                            data: programs_day5
                            modify: |-
                              var start = new Date(x.start);
                              var end = new Date(x.end);
                              String(start.getHours()).padStart(2,'0') + ":" +
                              String(start.getMinutes()).padStart(2,'0') + ' - ' +
                              String(end.getHours()).padStart(2,'0') + ":" +
                              String(end.getMinutes()).padStart(2,'0') + "<br/>" + x.length
                            align: center
                          - name: Program
                            data: programs_day5
                            modify: |-
                              if (!x.subtitle) {
                                x.title + '<br/>' + x.details + '<details><summary>Details</summary><p>' + x.description + '</p></details>'
                              } else {
                                x.title + ', ' + x.subtitle + '<br/>' + x.details + '<details><summary>Details</summary><p>' + x.description + '</p></details>'
                              }
            hold_action:
              action: none
            double_tap_action:
              action: none
            icon: mdi:clock
            content: Day 5
            card_mod: *style2
          - type: template

            tap_action:
              action: fire-dom-event
              browser_mod:
                service: browser_mod.popup
                hide_header: false
                data:
                  title: TV Guide - Today
                  content:
                    type: custom:layout-card
                    layout_type: custom:grid-layout
                    layout:
                      margin: 0
                      grid-template-columns: 1fr
                      grid-template-rows: 1fr
                      grid-template-areas: |
                        "col1"
                    cards:
                      - type: custom:hui-element
                        view_layout:
                          grid-area: col1
                        card_type: custom:flex-table-card
                        css:
                          table+: "padding: 0px; width: 100%; border-collapse: collapse;"
                          tbody tr:hover: "background-color: rgba(180, 70, 70,0.2) !important; color:white !important;"
                          tbody tr td:nth-child(1): "min-width: 1fr;width: 1fr; white-space: nowrap;"
                          th+: "border-bottom: 1px solid rgb(127,127,127);"
                        card_mod:
                          style:
                            .: |
                              ha-card {
                                overflow: auto;
                                box-shadow: none !important;
                                font-size: 12px;
                                }
                        entities:
                          include: "[[entity]]"
                        columns:
                          - name: Time
                            data: programs_day6
                            modify: |-
                              var start = new Date(x.start);
                              var end = new Date(x.end);
                              String(start.getHours()).padStart(2,'0') + ":" +
                              String(start.getMinutes()).padStart(2,'0') + ' - ' +
                              String(end.getHours()).padStart(2,'0') + ":" +
                              String(end.getMinutes()).padStart(2,'0') + "<br/>" + x.length
                            align: center
                          - name: Program
                            data: programs_day6
                            modify: |-
                              if (!x.subtitle) {
                                x.title + '<br/>' + x.details + '<details><summary>Details</summary><p>' + x.description + '</p></details>'
                              } else {
                                x.title + ', ' + x.subtitle + '<br/>' + x.details + '<details><summary>Details</summary><p>' + x.description + '</p></details>'
                              }
            hold_action:
              action: none
            double_tap_action:
              action: none
            icon: mdi:clock
            content: Day 6
            card_mod: *style2
          - type: template

            tap_action:
              action: fire-dom-event
              browser_mod:
                service: browser_mod.popup
                hide_header: false
                data:
                  title: TV Guide - Today
                  content:
                    type: custom:layout-card
                    layout_type: custom:grid-layout
                    layout:
                      margin: 0
                      grid-template-columns: 1fr
                      grid-template-rows: 1fr
                      grid-template-areas: |
                        "col1"
                    cards:
                      - type: custom:hui-element
                        view_layout:
                          grid-area: col1
                        card_type: custom:flex-table-card
                        css:
                          table+: "padding: 0px; width: 100%; border-collapse: collapse;"
                          tbody tr:hover: "background-color: rgba(180, 70, 70,0.2) !important; color:white !important;"
                          tbody tr td:nth-child(1): "min-width: 1fr;width: 1fr; white-space: nowrap;"
                          th+: "border-bottom: 1px solid rgb(127,127,127);"
                        card_mod:
                          style:
                            .: |
                              ha-card {
                                overflow: auto;
                                box-shadow: none !important;
                                font-size: 12px;
                                }
                        entities:
                          include: "[[entity]]"
                        columns:
                          - name: Time
                            data: programs_day7
                            modify: |-
                              var start = new Date(x.start);
                              var end = new Date(x.end);
                              String(start.getHours()).padStart(2,'0') + ":" +
                              String(start.getMinutes()).padStart(2,'0') + ' - ' +
                              String(end.getHours()).padStart(2,'0') + ":" +
                              String(end.getMinutes()).padStart(2,'0') + "<br/>" + x.length
                            align: center
                          - name: Program
                            data: programs_day7
                            modify: |-
                              if (!x.subtitle) {
                                x.title + '<br/>' + x.details + '<details><summary>Details</summary><p>' + x.description + '</p></details>'
                              } else {
                                x.title + ', ' + x.subtitle + '<br/>' + x.details + '<details><summary>Details</summary><p>' + x.description + '</p></details>'
                              }
            hold_action:
              action: none
            double_tap_action:
              action: none
            icon: mdi:clock
            content: Day 7
            card_mod: *style2
